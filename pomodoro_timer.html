<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer Widget</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const GamifiedPomodoro = () => {
            const [minutes, setMinutes] = React.useState(25);
            const [seconds, setSeconds] = React.useState(0);
            const [isActive, setIsActive] = React.useState(false);
            const [streak, setStreak] = React.useState(0);
            const [consecutiveCount, setConsecutiveCount] = React.useState(0);
            const [message, setMessage] = React.useState("Complete 3 Pomodoros for a streak bonus! üéØ");
            const [lastCompleted, setLastCompleted] = React.useState(Date.now());

            const messages = {
                start: ["Time to grow! üå±", "Let's focus! üéØ", "Fresh start! üçÖ"],
                complete: ["Ripe and ready! üçÖ", "Great harvest! üåü", "Perfectly done! üëè"],
                streak: ["Triple tomato bonus! üçÖüçÖüçÖ", "Growing champion! üåü", "Master gardener! üëë"]
            };

            React.useEffect(() => {
                let interval;
                if (isActive) {
                    interval = setInterval(() => {
                        if (seconds === 0) {
                            if (minutes === 0) {
                                handleComplete();
                            } else {
                                setMinutes(minutes - 1);
                                setSeconds(59);
                            }
                        } else {
                            setSeconds(seconds - 1);
                        }
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [isActive, minutes, seconds]);

            const handleComplete = () => {
                const now = Date.now();
                const timeSinceLastCompleted = now - lastCompleted;
                const isConsecutive = timeSinceLastCompleted <= 1000 * 60 * 30;
                
                setIsActive(false);
                setMinutes(25);
                setSeconds(0);
                setLastCompleted(now);

                if (isConsecutive) {
                    const newCount = consecutiveCount + 1;
                    setConsecutiveCount(newCount);
                    
                    if (newCount === 3) {
                        setStreak(streak + 3);
                        setMessage(messages.streak[Math.floor(Math.random() * messages.streak.length)]);
                        setConsecutiveCount(0);
                    } else {
                        setStreak(streak + 1);
                        setMessage(messages.complete[Math.floor(Math.random() * messages.complete.length)]);
                    }
                } else {
                    setConsecutiveCount(1);
                    setStreak(streak + 1);
                    setMessage(messages.complete[Math.floor(Math.random() * messages.complete.length)]);
                }
            };

            const toggleTimer = () => {
                if (!isActive) {
                    setMessage(messages.start[Math.floor(Math.random() * messages.start.length)]);
                }
                setIsActive(!isActive);
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-red-50">
                    <div className="flex flex-col items-center space-y-4">
                        {/* Tomato Shape */}
                        <div className={`relative w-64 h-64 rounded-full ${isActive ? 'bg-red-500' : 'bg-red-400'} 
                            transform transition-all duration-300 hover:scale-105 shadow-lg
                            flex items-center justify-center`}>
                            
                            {/* Leaf */}
                            <div className="absolute -top-2 left-1/2 -translate-x-1/2 w-16 h-8 bg-green-600 rounded-full rotate-45"></div>
                            
                            {/* Timer Display */}
                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
                                bg-white bg-opacity-90 rounded-full w-40 h-40 
                                flex flex-col items-center justify-center shadow-inner">
                                <div className="text-4xl font-mono font-bold text-gray-800">
                                    {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}
                                </div>
                                <div className="text-sm text-gray-600 mt-2 max-w-[120px] text-center">
                                    {message}
                                </div>
                            </div>

                            {/* Controls */}
                            <button
                                onClick={toggleTimer}
                                className={`absolute -bottom-6 transform -translate-x-1/2 left-1/2 px-6 py-2 rounded-full font-semibold
                                    ${isActive ? 
                                        'bg-red-600 text-white hover:bg-red-700' : 
                                        'bg-green-600 text-white hover:bg-green-700'
                                    } transition-colors duration-300`}
                            >
                                {isActive ? 'Pause' : 'Start'}
                            </button>
                        </div>

                        {/* Streak Display */}
                        <div className="flex items-center space-x-3 bg-white rounded-full px-4 py-2 shadow-md">
                            <div className="text-orange-500">üî•</div>
                            <span className="text-lg font-bold">{streak}</span>
                            <div className="flex space-x-1">
                                {[...Array(consecutiveCount)].map((_, i) => (
                                    <div key={i} className="text-yellow-400">‚≠ê</div>
                                ))}
                                {[...Array(3 - consecutiveCount)].map((_, i) => (
                                    <div key={i + consecutiveCount} className="text-gray-300">‚≠ê</div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<GamifiedPomodoro />, document.getElementById('root'));
    </script>
</body>
</html>
